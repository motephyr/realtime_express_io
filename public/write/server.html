<!DOCTYPE html>
<html>
<head>
  <title></title>
  <style type="text/css">
    body{
      -webkit-touch-callout: none;                /* prevent callout to copy image, etc when tap to hold */
      -webkit-user-select: none;
      background-color: antiquewhite;
    }

    .player_number_4{
      width:100%;
    }
    .player_number_4 .origincanvas{
      margin-left: 15%;
    }
    .player_number_3{
      width:100%;
    }
    .player_number_3 .origincanvas{
      margin-top: 10%;
      margin-left: 40px;
    }
    .player_number_2{
      width:100%;
    }
    .player_number_2 .origincanvas{
      margin-top: 10%;
      margin-left: 200px;
    }
    .player_number_1{
      width:100%;
    }
    .player_number_1 .origincanvas{
      margin-top: 20%;
      margin-left: 100%;
    }
  </style>
  <script type="text/javascript">
    window.realtime = {enabled: false};
    var socketLoadScript = document.createElement('script');
    socketLoadScript.type = 'text/javascript';
    socketLoadScript.src = "http://"+window.location.hostname+":5001/socket.io/socket.io.js";

    document.getElementsByTagName('head')[0].appendChild(socketLoadScript);
  </script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/canvas-manager.js"></script>
</head>
<body>
  <div style="float:left;">
    <div style="padding:5px 0;">
      <button id="player1">player1</button>
      <button id="player2">player2</button>
      <button id="player3">player3</button>
      <button id="player4">player4</button>
    </div>
    <div id="player_number" class="player_number_4">
      <canvas id="origin1" class="origincanvas"></canvas>
      <canvas id="origin2" class="origincanvas"></canvas>
      <canvas id="origin3" class="origincanvas"></canvas>
      <canvas id="origin4" class="origincanvas"></canvas>
    </div>
  </div>

  <script>
    $(function(){

      var canvas1 = $(document.getElementById('origin1'));
      var canvas2 = $(document.getElementById('origin2'));
      var canvas3 = $(document.getElementById('origin3'));
      var canvas4 = $(document.getElementById('origin4'));

      var canvasShowState = [ true, true, true, true];

      var switchCanvasShow = function(theCanvas){
        if (canvasShowState[theCanvas-1]){
          $(document.getElementById('origin'+theCanvas)).show();
        }else{
          $(document.getElementById('origin'+theCanvas)).hide();
        }
      }

      var putCanvasShowState = function(theCanvas){
        if(canvasShowState[theCanvas-1] === true){
          canvasShowState[theCanvas-1] = false;
        }else{
          canvasShowState[theCanvas-1] = true;
        }

        return canvasShowState[theCanvas-1];
      }

      var getCanvasShowCounts = function(){
        var total = 0;
        for (var i=0 ; i < canvasShowState.length; i++){
          if (canvasShowState[i] === true){
            total++;
          }
        }
        return total;
      }

      document.getElementById('player1').addEventListener('click',function(){
        putCanvasShowState(1);
        switchCanvasShow(1);
        document.getElementById('player_number').className = 'player_number_'+getCanvasShowCounts();
      });

      document.getElementById('player2').addEventListener('click',function(){
        putCanvasShowState(2);
        switchCanvasShow(2);
        document.getElementById('player_number').className = 'player_number_'+getCanvasShowCounts();
      });

      document.getElementById('player3').addEventListener('click',function(){
        putCanvasShowState(3);
        switchCanvasShow(3);
        document.getElementById('player_number').className = 'player_number_'+getCanvasShowCounts();
      });

      document.getElementById('player4').addEventListener('click',function(){
        putCanvasShowState(4);
        switchCanvasShow(4);
        document.getElementById('player_number').className = 'player_number_'+getCanvasShowCounts();
      })

    });

window.onload = function(){

  if (typeof io != 'undefined' && io != null) {
    window.realtime.token = '291c8816b32d71664f45c3e2278967dc';
    window.realtime.userId = 'server';
    window.realtime.socketIo = io.connect(
      'http://'+window.location.hostname+':5001/?_rtUserId='+ window.realtime.userId +'&_rtToken='+ window.realtime.token
      );
  }

  if (window.realtime.socketIo) {

    window.realtime.enabled = true;

    window.realtime.socketIo.on('connect', function() {
      // Give a nice round-trip ACK to our realtime server that we connected.
      window.realtime.socketIo.emit('realtime_user_id_connected');
      console.log("connect");
    });

    window.realtime.socketIo.on('realtime_user_id_connected',function(message){
      console.log("user_id:"+message.user_id);
    });

    window.realtime.socketIo.on('disconnect', function() {
      // Give a nice round-trip ACK to our realtime server that we connected.
      console.log("disconnect");
    });

    window.realtime.socketIo.on('down_location', function(e) {

      CM('origin'+ e.user_id).point(e);
    });

    window.realtime.socketIo.on('move_location', function(e) {
      CM('origin'+ e.user_id).line(e);
    });

    window.realtime.socketIo.on('up_location', function() {
    });

    window.realtime.socketIo.on('clear', function(e) {
      CM('origin'+ e.user_id).clear();
    });

  }

  CM.prop({
    width: 500,
    height: 500,
    lineWidth: 15,
    lineColor: '#333333',
    targetZoomScale: 0.7,
    backgroundImage: '/image/block-525.png'
  });

  CM.reg('origin1');
  CM.reg('origin2');
  CM.reg('origin3');
  CM.reg('origin4');


};

</script>
</body>
</html>